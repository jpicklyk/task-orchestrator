# v2.0 Migration Guide

**Version:** 2.0.0
**Date:** 2025-10-19
**Status:** Breaking Changes - Requires Migration

## Overview

Task Orchestrator v2.0 introduces **container-based tool consolidation** that reduces the tool count from **56 tools to 18 tools** (68% reduction), achieving massive token savings and providing a consistent, permission-separated interface across all operations.

### Scope of v2.0 Consolidation

**Container Tools (Projects/Features/Tasks):**
- **Before:** 40+ specialized tools
- **After:** 2 unified container tools
  - `query_container` - All read operations (get, search, export, overview)
  - `manage_container` - All write operations (create, update, delete, setStatus, bulkUpdate)

**Section Tools:**
- **Before:** 11 specialized tools
- **After:** 2 unified section tools
  - `query_sections` - Read-only section queries with filtering
  - `manage_sections` - All write operations (add, update, updateText, updateMetadata, delete, reorder, bulk operations)

**Template Tools:**
- **Before:** 9 specialized tools
- **After:** 3 unified template tools
  - `query_templates` - Read operations (get, list)
  - `manage_template` - Write operations (create, update, delete, enable, disable, addSection)
  - `apply_template` - Unchanged (still a dedicated tool)

**Dependency Tools:**
- **Before:** 3 specialized tools
- **After:** 2 unified dependency tools
  - `query_dependencies` - Read-only dependency queries with filtering
  - `manage_dependency` - Write operations (create, delete)

**Unchanged Tools (9):**
- `list_tags`, `get_tag_usage`, `rename_tag` - Tag management
- `setup_claude_orchestration`, `get_agent_definition`, `recommend_agent` - Agent automation
- `apply_template` - Template application (kept separate due to complexity)
- **`get_next_task`** - Intelligent task recommendation with dependency checking and priority sorting
- **`get_blocked_tasks`** - Dependency blocking analysis

**IMPORTANT:** `get_next_task` and `get_blocked_tasks` are **NOT consolidated** and remain standalone tools. They contain complex recommendation logic (dependency checking, priority sorting, quick wins algorithm) that **cannot be replicated** with simple `query_container` filters.

### Why v2.0 Consolidation?

**Token Efficiency Crisis:** In v1.x, AI agents loaded 56 separate MCP tool schemas for every request:
- Container tools alone: ~40 tools × ~1,200 chars = ~48,000 characters per request
- Total tool overhead: 56 tools consuming massive context windows
- Slower AI response times due to schema processing

**v2.0 Benefits:**
- ✅ **71% token reduction** (56 tools → 16 tools)
- ✅ **Container tools**: ~48k → ~3.4k characters (93% reduction)
- ✅ **Permission separation**: `query_*` (read-only) vs `manage_*` (write operations)
- ✅ **Consistent patterns**: `operation` + `containerType`/`entityType` parameters
- ✅ **Simpler mental model**: Unified interface across all operations
- ✅ **Future-proof**: Easy to add new operations without new tools

### What Changed

**Breaking Changes (v2.0):**
- **40+ container tools REMOVED** (create_task, get_task, update_task, etc.)
- **11 section tools REMOVED** (get_sections, add_section, update_section, etc.)
- **9 template tools REMOVED** (list_templates, get_template, create_template, etc.)
- **3 dependency tools REMOVED** (get_task_dependencies, create_dependency, delete_dependency)
- **New parameter model**: All tools now use `operation` enum + entity type specification

**Migration Requirements:**
- Update all MCP tool calls to v2.0 syntax
- Add `operation` parameter to all consolidated tools
- Add `containerType` or `entityType` parameter to specify entity type
- Review permission model (read vs write operations)

### Timeline

- **v1.1.0 (2025-10-18):** Partial consolidation (tasks/features/projects only)
- **v2.0.0 (2025-10-19):** **BREAKING CHANGES** - Full consolidation (all tools)
- **Migration period:** None - v2.0 requires immediate migration
- **Rollback option:** Downgrade to v1.1.0 if needed

---

## Complete Tool Mapping Table

### Container Tools (Projects, Features, Tasks)

| Old Tool (v1.x) | New Tool (v2.0) | Operation | Container Type |
|-----------------|----------------|-----------|----------------|
| **Task Tools** | | | |
| `create_task` | `manage_container` | `create` | `task` |
| `get_task` | `query_container` | `get` | `task` |
| `update_task` | `manage_container` | `update` | `task` |
| `delete_task` | `manage_container` | `delete` | `task` |
| `search_tasks` | `query_container` | `search` | `task` |
| `bulk_update_tasks` | `manage_container` | `bulkUpdate` | `task` |
| `task_to_markdown` | `query_container` | `export` | `task` |
| `set_task_status` | `manage_container` | `setStatus` | `task` |
| **Feature Tools** | | | |
| `create_feature` | `manage_container` | `create` | `feature` |
| `get_feature` | `query_container` | `get` | `feature` |
| `update_feature` | `manage_container` | `update` | `feature` |
| `delete_feature` | `manage_container` | `delete` | `feature` |
| `list_features` | `query_container` | `search` | `feature` |
| `feature_to_markdown` | `query_container` | `export` | `feature` |
| `set_feature_status` | `manage_container` | `setStatus` | `feature` |
| **Project Tools** | | | |
| `create_project` | `manage_container` | `create` | `project` |
| `get_project` | `query_container` | `get` | `project` |
| `update_project` | `manage_container` | `update` | `project` |
| `delete_project` | `manage_container` | `delete` | `project` |
| `list_projects` | `query_container` | `search` | `project` |
| `project_to_markdown` | `query_container` | `export` | `project` |
| `set_project_status` | `manage_container` | `setStatus` | `project` |
| **Overview Tool** | | | |
| `get_overview` | `query_container` | `overview` | (any/all types) |

### Section Tools

| Old Tool (v1.x) | New Tool (v2.0) | Operation |
|-----------------|----------------|-----------|
| `get_sections` | `query_sections` | (single operation, filtering via params) |
| `add_section` | `manage_sections` | `add` |
| `update_section` | `manage_sections` | `update` |
| `update_section_text` | `manage_sections` | `updateText` |
| `update_section_metadata` | `manage_sections` | `updateMetadata` |
| `delete_section` | `manage_sections` | `delete` |
| `reorder_sections` | `manage_sections` | `reorder` |
| `bulk_create_sections` | `manage_sections` | `bulkCreate` |
| `bulk_update_sections` | `manage_sections` | `bulkUpdate` |
| `bulk_delete_sections` | `manage_sections` | `bulkDelete` |

### Template Tools

| Old Tool (v1.x) | New Tool (v2.0) | Operation |
|-----------------|----------------|-----------|
| `list_templates` | `query_templates` | `list` |
| `get_template` | `query_templates` | `get` |
| `create_template` | `manage_template` | `create` |
| `update_template_metadata` | `manage_template` | `update` |
| `delete_template` | `manage_template` | `delete` |
| `enable_template` | `manage_template` | `enable` |
| `disable_template` | `manage_template` | `disable` |
| `add_template_section` | `manage_template` | `addSection` |
| `apply_template` | `apply_template` | (unchanged) |

### Dependency Tools

| Old Tool (v1.x) | New Tool (v2.0) | Operation |
|-----------------|----------------|-----------|
| `get_task_dependencies` | `query_dependencies` | (single operation, filtering via params) |
| `create_dependency` | `manage_dependency` | `create` |
| `delete_dependency` | `manage_dependency` | `delete` |

---

## Migration Examples

### Container Tools Migration

#### Example 1: Create Task

**v1.x:**
```json
{
  "tool": "create_task",
  "parameters": {
    "title": "Implement user authentication",
    "summary": "Add JWT-based authentication to the API",
    "status": "pending",
    "priority": "high",
    "complexity": 7,
    "tags": "backend,security,api",
    "featureId": "550e8400-e29b-41d4-a716-446655440000",
    "templateIds": ["661e8511-e29b-41d4-a716-446655440001"]
  }
}
```

**v2.0:**
```json
{
  "tool": "manage_container",
  "parameters": {
    "operation": "create",
    "containerType": "task",
    "title": "Implement user authentication",
    "summary": "Add JWT-based authentication to the API",
    "status": "pending",
    "priority": "high",
    "complexity": 7,
    "tags": "backend,security,api",
    "featureId": "550e8400-e29b-41d4-a716-446655440000",
    "templateIds": ["661e8511-e29b-41d4-a716-446655440001"]
  }
}
```

**Changes:**
- ✅ Change tool: `create_task` → `manage_container`
- ✅ Add: `"operation": "create"`
- ✅ Add: `"containerType": "task"`
- ✅ All other parameters identical

---

#### Example 2: Get Task with Sections

**v1.x:**
```json
{
  "tool": "get_task",
  "parameters": {
    "id": "640522b7-810e-49a2-865c-3725f5d39608",
    "includeSections": true,
    "includeFeature": true,
    "includeDependencies": true
  }
}
```

**v2.0:**
```json
{
  "tool": "query_container",
  "parameters": {
    "operation": "get",
    "containerType": "task",
    "id": "640522b7-810e-49a2-865c-3725f5d39608",
    "includeSections": true
  }
}
```

**Changes:**
- ✅ Change tool: `get_task` → `query_container`
- ✅ Add: `"operation": "get"`
- ✅ Add: `"containerType": "task"`
- ⚠️ Removed: `includeFeature`, `includeDependencies` (not supported in v2.0 - use separate queries)

---

#### Example 3: Update Task Status

**v1.x:**
```json
{
  "tool": "update_task",
  "parameters": {
    "id": "640522b7-810e-49a2-865c-3725f5d39608",
    "status": "completed"
  }
}
```

**v2.0 Option A (setStatus operation):**
```json
{
  "tool": "manage_container",
  "parameters": {
    "operation": "setStatus",
    "containerType": "task",
    "id": "640522b7-810e-49a2-865c-3725f5d39608",
    "status": "completed"
  }
}
```

**v2.0 Option B (update operation):**
```json
{
  "tool": "manage_container",
  "parameters": {
    "operation": "update",
    "containerType": "task",
    "id": "640522b7-810e-49a2-865c-3725f5d39608",
    "status": "completed"
  }
}
```

**Changes:**
- ✅ Change tool: `update_task` → `manage_container`
- ✅ Add: `"operation": "setStatus"` or `"update"`
- ✅ Add: `"containerType": "task"`
- ✅ `setStatus` is optimized for status-only changes

---

#### Example 4: Search Tasks with Filters

**v1.x:**
```json
{
  "tool": "search_tasks",
  "parameters": {
    "status": "pending",
    "priority": "high",
    "tags": "backend",
    "featureId": "550e8400-e29b-41d4-a716-446655440000",
    "limit": 20
  }
}
```

**v2.0:**
```json
{
  "tool": "query_container",
  "parameters": {
    "operation": "search",
    "containerType": "task",
    "status": "pending",
    "priority": "high",
    "tags": "backend",
    "featureId": "550e8400-e29b-41d4-a716-446655440000",
    "limit": 20
  }
}
```

**Changes:**
- ✅ Change tool: `search_tasks` → `query_container`
- ✅ Add: `"operation": "search"`
- ✅ Add: `"containerType": "task"`
- ✅ All filter parameters identical

---

#### Example 5: Export Task to Markdown

**v1.x:**
```json
{
  "tool": "task_to_markdown",
  "parameters": {
    "id": "640522b7-810e-49a2-865c-3725f5d39608",
    "includeSections": true
  }
}
```

**v2.0:**
```json
{
  "tool": "query_container",
  "parameters": {
    "operation": "export",
    "containerType": "task",
    "id": "640522b7-810e-49a2-865c-3725f5d39608",
    "includeSections": true
  }
}
```

**Changes:**
- ✅ Change tool: `task_to_markdown` → `query_container`
- ✅ Add: `"operation": "export"`
- ✅ Add: `"containerType": "task"`
- ✅ Export format defaults to markdown (can specify `"format": "json"`)

---

#### Example 6: Bulk Update Tasks

**v1.x:**
```json
{
  "tool": "bulk_update_tasks",
  "parameters": {
    "tasks": [
      {"id": "task-1-uuid", "status": "completed"},
      {"id": "task-2-uuid", "status": "completed"}
    ]
  }
}
```

**v2.0:**
```json
{
  "tool": "manage_container",
  "parameters": {
    "operation": "bulkUpdate",
    "containerType": "task",
    "containers": [
      {"id": "task-1-uuid", "status": "completed"},
      {"id": "task-2-uuid", "status": "completed"}
    ]
  }
}
```

**Changes:**
- ✅ Change tool: `bulk_update_tasks` → `manage_container`
- ✅ Add: `"operation": "bulkUpdate"`
- ✅ Add: `"containerType": "task"`
- ✅ Rename: `"tasks"` → `"containers"` (generalized parameter name)

---

#### Example 7: Create Feature

**v1.x:**
```json
{
  "tool": "create_feature",
  "parameters": {
    "name": "User Authentication System",
    "summary": "Comprehensive authentication with OAuth",
    "status": "planning",
    "priority": "high",
    "projectId": "a4fae8cb-7640-4527-bd89-11effbb1d039"
  }
}
```

**v2.0:**
```json
{
  "tool": "manage_container",
  "parameters": {
    "operation": "create",
    "containerType": "feature",
    "name": "User Authentication System",
    "summary": "Comprehensive authentication with OAuth",
    "status": "planning",
    "priority": "high",
    "projectId": "a4fae8cb-7640-4527-bd89-11effbb1d039"
  }
}
```

**Changes:**
- ✅ Change tool: `create_feature` → `manage_container`
- ✅ Add: `"operation": "create"`
- ✅ Add: `"containerType": "feature"`

---

#### Example 8: Get Overview

**v1.x:**
```json
{
  "tool": "get_overview",
  "parameters": {
    "projectId": "a4fae8cb-7640-4527-bd89-11effbb1d039",
    "summaryLength": 100
  }
}
```

**v2.0:**
```json
{
  "tool": "query_container",
  "parameters": {
    "operation": "overview",
    "containerType": "task",
    "projectId": "a4fae8cb-7640-4527-bd89-11effbb1d039",
    "summaryLength": 100
  }
}
```

**Changes:**
- ✅ Change tool: `get_overview` → `query_container`
- ✅ Add: `"operation": "overview"`
- ✅ Add: `"containerType": "task"` (or "feature"/"project" to filter overview)

---

### Section Tools Migration

#### Example 9: Query Sections

**v1.x:**
```json
{
  "tool": "get_sections",
  "parameters": {
    "entityType": "TASK",
    "entityId": "640522b7-810e-49a2-865c-3725f5d39608",
    "includeSections": true
  }
}
```

**v2.0:**
```json
{
  "tool": "query_sections",
  "parameters": {
    "entityType": "TASK",
    "entityId": "640522b7-810e-49a2-865c-3725f5d39608",
    "includeContent": true
  }
}
```

**Changes:**
- ✅ Change tool: `get_sections` → `query_sections`
- ✅ Rename: `"includeSections"` → `"includeContent"`
- ✅ Add filtering options: `sectionIds`, `tags` (new in v2.0)

---

#### Example 10: Add Section

**v1.x:**
```json
{
  "tool": "add_section",
  "parameters": {
    "entityType": "TASK",
    "entityId": "640522b7-810e-49a2-865c-3725f5d39608",
    "title": "Implementation Notes",
    "usageDescription": "Technical implementation details",
    "content": "Use JWT tokens for stateless authentication",
    "contentFormat": "MARKDOWN",
    "ordinal": 0,
    "tags": "implementation,backend"
  }
}
```

**v2.0:**
```json
{
  "tool": "manage_sections",
  "parameters": {
    "operation": "add",
    "entityType": "TASK",
    "entityId": "640522b7-810e-49a2-865c-3725f5d39608",
    "title": "Implementation Notes",
    "usageDescription": "Technical implementation details",
    "content": "Use JWT tokens for stateless authentication",
    "contentFormat": "MARKDOWN",
    "ordinal": 0,
    "tags": "implementation,backend"
  }
}
```

**Changes:**
- ✅ Change tool: `add_section` → `manage_sections`
- ✅ Add: `"operation": "add"`
- ✅ All other parameters identical

---

#### Example 11: Update Section Text

**v1.x:**
```json
{
  "tool": "update_section_text",
  "parameters": {
    "id": "section-uuid",
    "oldText": "Use JWT tokens",
    "newText": "Use OAuth 2.0 with JWT tokens"
  }
}
```

**v2.0:**
```json
{
  "tool": "manage_sections",
  "parameters": {
    "operation": "updateText",
    "id": "section-uuid",
    "oldText": "Use JWT tokens",
    "newText": "Use OAuth 2.0 with JWT tokens"
  }
}
```

**Changes:**
- ✅ Change tool: `update_section_text` → `manage_sections`
- ✅ Add: `"operation": "updateText"`

---

#### Example 12: Bulk Create Sections

**v1.x:**
```json
{
  "tool": "bulk_create_sections",
  "parameters": {
    "entityType": "TASK",
    "entityId": "640522b7-810e-49a2-865c-3725f5d39608",
    "sections": [
      {"title": "Requirements", "content": "...", "ordinal": 0},
      {"title": "Implementation", "content": "...", "ordinal": 1}
    ]
  }
}
```

**v2.0:**
```json
{
  "tool": "manage_sections",
  "parameters": {
    "operation": "bulkCreate",
    "entityType": "TASK",
    "entityId": "640522b7-810e-49a2-865c-3725f5d39608",
    "sections": [
      {"title": "Requirements", "content": "...", "ordinal": 0},
      {"title": "Implementation", "content": "...", "ordinal": 1}
    ]
  }
}
```

**Changes:**
- ✅ Change tool: `bulk_create_sections` → `manage_sections`
- ✅ Add: `"operation": "bulkCreate"`

---

### Template Tools Migration

#### Example 13: List Templates

**v1.x:**
```json
{
  "tool": "list_templates",
  "parameters": {
    "targetEntityType": "TASK",
    "isEnabled": true,
    "tags": "backend,api"
  }
}
```

**v2.0:**
```json
{
  "tool": "query_templates",
  "parameters": {
    "operation": "list",
    "targetEntityType": "TASK",
    "isEnabled": true,
    "tags": "backend,api"
  }
}
```

**Changes:**
- ✅ Change tool: `list_templates` → `query_templates`
- ✅ Add: `"operation": "list"`

---

#### Example 14: Get Template

**v1.x:**
```json
{
  "tool": "get_template",
  "parameters": {
    "id": "template-uuid",
    "includeSections": true
  }
}
```

**v2.0:**
```json
{
  "tool": "query_templates",
  "parameters": {
    "operation": "get",
    "id": "template-uuid",
    "includeSections": true
  }
}
```

**Changes:**
- ✅ Change tool: `get_template` → `query_templates`
- ✅ Add: `"operation": "get"`

---

#### Example 15: Create Template

**v1.x:**
```json
{
  "tool": "create_template",
  "parameters": {
    "name": "API Development Template",
    "description": "Template for API feature development",
    "targetEntityType": "TASK",
    "tags": "backend,api"
  }
}
```

**v2.0:**
```json
{
  "tool": "manage_template",
  "parameters": {
    "operation": "create",
    "name": "API Development Template",
    "description": "Template for API feature development",
    "targetEntityType": "TASK",
    "tags": "backend,api"
  }
}
```

**Changes:**
- ✅ Change tool: `create_template` → `manage_template`
- ✅ Add: `"operation": "create"`

---

#### Example 16: Enable/Disable Template

**v1.x:**
```json
{
  "tool": "enable_template",
  "parameters": {
    "id": "template-uuid"
  }
}
```

**v2.0:**
```json
{
  "tool": "manage_template",
  "parameters": {
    "operation": "enable",
    "id": "template-uuid"
  }
}
```

**Changes:**
- ✅ Change tool: `enable_template` → `manage_template`
- ✅ Add: `"operation": "enable"` (or `"disable"`)

---

### Dependency Tools Migration

#### Example 17: Query Dependencies

**v1.x:**
```json
{
  "tool": "get_task_dependencies",
  "parameters": {
    "taskId": "640522b7-810e-49a2-865c-3725f5d39608"
  }
}
```

**v2.0:**
```json
{
  "tool": "query_dependencies",
  "parameters": {
    "taskId": "640522b7-810e-49a2-865c-3725f5d39608",
    "direction": "all",
    "includeTaskInfo": false
  }
}
```

**Changes:**
- ✅ Change tool: `get_task_dependencies` → `query_dependencies`
- ✅ Add filtering: `direction` (incoming/outgoing/all), `type`, `includeTaskInfo`

---

#### Example 18: Create Dependency

**v1.x:**
```json
{
  "tool": "create_dependency",
  "parameters": {
    "fromTaskId": "task-1-uuid",
    "toTaskId": "task-2-uuid",
    "type": "BLOCKS"
  }
}
```

**v2.0:**
```json
{
  "tool": "manage_dependency",
  "parameters": {
    "operation": "create",
    "fromTaskId": "task-1-uuid",
    "toTaskId": "task-2-uuid",
    "type": "BLOCKS"
  }
}
```

**Changes:**
- ✅ Change tool: `create_dependency` → `manage_dependency`
- ✅ Add: `"operation": "create"`

---

#### Example 19: Delete Dependency

**v1.x:**
```json
{
  "tool": "delete_dependency",
  "parameters": {
    "id": "dependency-uuid"
  }
}
```

**v2.0:**
```json
{
  "tool": "manage_dependency",
  "parameters": {
    "operation": "delete",
    "id": "dependency-uuid"
  }
}
```

**Changes:**
- ✅ Change tool: `delete_dependency` → `manage_dependency`
- ✅ Add: `"operation": "delete"`

---

## Permission Model Changes

### v1.x Permission Model
- **Mixed:** Tools didn't clearly separate read vs write operations
- **Example:** `get_task` (read), `update_task` (write) were separate tools

### v2.0 Permission Model
- **Clear Separation:** `query_*` tools are read-only, `manage_*` tools are write operations
- **Benefits:**
  - Easier to implement permission controls
  - Simpler security auditing
  - Clear intent from tool name

### Permission Matrix

| Tool | Permission | Locking | Operations |
|------|-----------|---------|-----------|
| `query_container` | Read-only | No | get, search, export, overview |
| `manage_container` | Read-write | Yes | create, update, delete, setStatus, bulkUpdate |
| `query_sections` | Read-only | No | Query with filtering |
| `manage_sections` | Read-write | Yes | add, update, updateText, updateMetadata, delete, reorder, bulk ops |
| `query_templates` | Read-only | No | get, list |
| `manage_template` | Read-write | Yes | create, update, delete, enable, disable, addSection |
| `query_dependencies` | Read-only | No | Query with filtering |
| `manage_dependency` | Read-write | Yes | create, delete |

---

## EntityType Parameter Pattern

### Understanding `containerType` vs `entityType`

**`containerType`** (Container tools):
- Used in: `query_container`, `manage_container`
- Values: `"project"`, `"feature"`, `"task"`
- Purpose: Specify which type of container you're working with

**`entityType`** (Section tools):
- Used in: `query_sections`, `manage_sections`
- Values: `"PROJECT"`, `"FEATURE"`, `"TASK"` (uppercase)
- Purpose: Specify which entity type the sections belong to

### Why Different Naming?

- **Containers** are the primary entities (projects, features, tasks)
- **Sections** belong to entities (they're attached TO containers)
- This distinction makes the relationship clear

### Usage Examples

**Container query:**
```json
{
  "tool": "query_container",
  "parameters": {
    "operation": "get",
    "containerType": "task",  // lowercase
    "id": "..."
  }
}
```

**Section query:**
```json
{
  "tool": "query_sections",
  "parameters": {
    "entityType": "TASK",  // uppercase
    "entityId": "..."
  }
}
```

---

## Operation Reference Tables

### `query_container` Operations

| Operation | Purpose | Required Parameters | Optional Parameters |
|-----------|---------|---------------------|---------------------|
| `get` | Retrieve single container | `containerType`, `id` | `includeSections` |
| `search` | Find containers by filters | `containerType` | `query`, `status`, `priority`, `tags`, `projectId`, `featureId`, `limit` |
| `export` | Export container to markdown/JSON | `containerType`, `id` | `includeSections` |
| `overview` | Get project overview | `containerType` | `projectId`, `summaryLength` |

### `manage_container` Operations

| Operation | Purpose | Required Parameters | Optional Parameters |
|-----------|---------|---------------------|---------------------|
| `create` | Create new container | `containerType`, `name` or `title` | `summary`, `description`, `status`, `priority`, `complexity`, `projectId`, `featureId`, `tags`, `templateIds` |
| `update` | Update container | `containerType`, `id` | Any container field (partial updates) |
| `delete` | Remove container | `containerType`, `id` | `deleteSections`, `force` |
| `setStatus` | Update status only | `containerType`, `id`, `status` | None |
| `bulkUpdate` | Update multiple containers | `containerType`, `containers` | None (fields in container objects) |

### `query_sections` Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `entityType` | enum | Yes | PROJECT, FEATURE, or TASK |
| `entityId` | UUID | Yes | Entity identifier |
| `includeContent` | boolean | No | Include content (default: true) |
| `sectionIds` | array | No | Filter to specific section IDs |
| `tags` | string | No | Comma-separated tags filter |

### `manage_sections` Operations

| Operation | Purpose | Required Parameters | Optional Parameters |
|-----------|---------|---------------------|---------------------|
| `add` | Create section | `entityType`, `entityId`, `title` | `usageDescription`, `content`, `contentFormat`, `ordinal`, `tags` |
| `update` | Update section | `id` | `title`, `usageDescription`, `content`, `contentFormat`, `tags` |
| `updateText` | Replace text in section | `id`, `oldText`, `newText` | None |
| `updateMetadata` | Update metadata only | `id` | `title`, `usageDescription`, `contentFormat`, `tags` |
| `delete` | Remove section | `id` | None |
| `reorder` | Reorder sections | `entityType`, `entityId`, `sectionOrder` | None |
| `bulkCreate` | Create multiple sections | `entityType`, `entityId`, `sections` | None |
| `bulkUpdate` | Update multiple sections | `sections` | None |
| `bulkDelete` | Delete multiple sections | `ids` | None |

### `query_templates` Operations

| Operation | Purpose | Required Parameters | Optional Parameters |
|-----------|---------|---------------------|---------------------|
| `get` | Retrieve template | `id` | `includeSections` |
| `list` | List templates | None | `targetEntityType`, `isBuiltIn`, `isEnabled`, `tags` |

### `manage_template` Operations

| Operation | Purpose | Required Parameters | Optional Parameters |
|-----------|---------|---------------------|---------------------|
| `create` | Create template | `name`, `description`, `targetEntityType` | `isBuiltIn`, `isProtected`, `isEnabled`, `createdBy`, `tags` |
| `update` | Update template | `id` | `name`, `description`, `tags` |
| `delete` | Remove template | `id` | `force` |
| `enable` | Enable template | `id` | None |
| `disable` | Disable template | `id` | None |
| `addSection` | Add template section | `id`, `title`, `usageDescription`, `contentSample`, `ordinal` | `contentFormat`, `tags`, `isRequired` |

### `query_dependencies` Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `taskId` | UUID | Yes | Task to query dependencies for |
| `direction` | enum | No | incoming, outgoing, all (default: all) |
| `type` | enum | No | BLOCKS, IS_BLOCKED_BY, RELATES_TO, all |
| `includeTaskInfo` | boolean | No | Include task details (default: false) |

### `manage_dependency` Operations

| Operation | Purpose | Required Parameters | Optional Parameters |
|-----------|---------|---------------------|---------------------|
| `create` | Create dependency | `fromTaskId`, `toTaskId` | `type` |
| `delete` | Remove dependency | `id` OR (`fromTaskId` + `toTaskId`) | `type`, `deleteAll` |

---

## Rollback Procedures

### If Migration Fails

**Option 1: Downgrade to v1.1.0**
```bash
# Docker
docker pull jpickly/mcp-task-orchestrator:1.1.0
docker run --rm -i -v mcp-task-data:/app/data jpickly/mcp-task-orchestrator:1.1.0

# Local build
git checkout v1.1.0
./gradlew clean build
java -jar build/libs/mcp-task-orchestrator-1.1.0.jar
```

**Option 2: Database Backup/Restore**
```bash
# Backup before migration
cp data/tasks.db data/tasks_backup_pre_v2.db

# Restore if needed
cp data/tasks_backup_pre_v2.db data/tasks.db
```

### Data Compatibility

- **Database schema unchanged** - v2.0 only changes MCP tools, not data layer
- **No data migration required** - rollback is safe
- **Repository layer backward compatible** - same data access patterns

---

## Troubleshooting Guide

### Common Migration Issues

#### Issue 1: "Unknown tool" error

**Symptom:**
```json
{"error": "Unknown tool: create_task"}
```

**Cause:** Using v1.x tool name with v2.0 server

**Solution:** Update to v2.0 tool name:
```json
{
  "tool": "manage_container",
  "parameters": {
    "operation": "create",
    "containerType": "task",
    ...
  }
}
```

---

#### Issue 2: "Missing required parameter: operation"

**Symptom:**
```json
{"error": "Missing required parameter: operation"}
```

**Cause:** Forgot to add `operation` parameter

**Solution:** Add operation parameter:
```json
{
  "tool": "manage_container",
  "parameters": {
    "operation": "create",  // Add this
    "containerType": "task",
    ...
  }
}
```

---

#### Issue 3: "Missing required parameter: containerType"

**Symptom:**
```json
{"error": "Missing required parameter: containerType"}
```

**Cause:** Forgot to specify container type

**Solution:** Add containerType:
```json
{
  "tool": "query_container",
  "parameters": {
    "operation": "get",
    "containerType": "task",  // Add this
    "id": "..."
  }
}
```

---

#### Issue 4: Case sensitivity errors with entityType

**Symptom:**
```json
{"error": "Invalid entityType: task"}
```

**Cause:** Used lowercase for `entityType` (should be uppercase)

**Solution:** Use uppercase for entityType:
```json
{
  "tool": "query_sections",
  "parameters": {
    "entityType": "TASK",  // Not "task"
    "entityId": "..."
  }
}
```

**Note:** `containerType` is lowercase, `entityType` is uppercase!

---

#### Issue 5: "Unknown operation" error

**Symptom:**
```json
{"error": "Unknown operation: export for tool manage_container"}
```

**Cause:** Used read operation with write tool (or vice versa)

**Solution:** Check operation/tool pairing:
- `export` → Use `query_container` (read-only)
- `create`/`update`/`delete` → Use `manage_container` (write)

---

#### Issue 6: Parameters renamed

**Symptom:**
```json
{"error": "Unknown parameter: tasks"}
```

**Cause:** Used old parameter name (v1.x) instead of new (v2.0)

**Solution:** Update parameter names:
- `tasks` → `containers` (bulk updates)
- `includeSections` → `includeContent` (sections)

---

## FAQ

### Q: Do I need to migrate immediately?

**A:** Yes. v2.0 is a breaking change - old tool names are completely removed. There is no deprecation period.

### Q: Will old tools show errors?

**A:** Yes. Using old tool names (e.g., `create_task`) will return "Unknown tool" errors.

### Q: Can I use both v1.x and v2.0 tools together?

**A:** No. v2.0 removes all old tools. You must migrate all tool calls to v2.0 syntax.

### Q: Are responses identical between old and new tools?

**A:** Mostly yes. Response formats are nearly identical, with minor enhancements for consistency.

### Q: What about performance?

**A:** Performance is identical or better. Token savings improve overall AI agent efficiency.

### Q: Is the database affected?

**A:** No. Database schema is unchanged. v2.0 only changes the MCP tool layer, not data storage.

### Q: Can I roll back after migrating?

**A:** Yes. Downgrade to v1.1.0 and your data will work unchanged (database schema is compatible).

### Q: What if I have custom scripts using old tools?

**A:** You must update your scripts to use v2.0 tool syntax. Refer to the migration examples above.

### Q: Do AI agents need reconfiguration?

**A:** AI agents discover tools automatically via MCP. No manual reconfiguration needed - they'll use new tools immediately.

### Q: Why are some parameters case-sensitive?

**A:** `containerType` uses lowercase (matches domain model), `entityType` uses uppercase (matches enum). This distinction is intentional for clarity.

---

## Additional Resources

### Documentation

- **API Reference:** [docs/api-reference.md](../api-reference.md) - Complete v2.0 tool documentation
- **Tool Guides:**
  - [docs/tools/query-container.md](../tools/query-container.md)
  - [docs/tools/manage-container.md](../tools/manage-container.md)
  - [docs/tools/query-sections.md](../tools/query-sections.md)
  - [docs/tools/manage-sections.md](../tools/manage-sections.md)
  - [docs/tools/query-templates.md](../tools/query-templates.md)
  - [docs/tools/manage-template.md](../tools/manage-template.md)
  - [docs/tools/query-dependencies.md](../tools/query-dependencies.md)
  - [docs/tools/manage-dependency.md](../tools/manage-dependency.md)

### Workflow Documentation

- **AI Guidelines:** [docs/ai-guidelines.md](../ai-guidelines.md) - v2.0 best practices for AI agents
- **Workflow Prompts:** [docs/workflow-prompts.md](../workflow-prompts.md) - Updated workflows
- **Templates Guide:** [docs/templates.md](../templates.md) - Template usage with v2.0

### Support

- **GitHub Issues:** [github.com/jpickly/mcp-task-orchestrator/issues](https://github.com/jpickly/mcp-task-orchestrator/issues)
- **Migration Assistance:** Open an issue with "Migration" tag if you encounter problems
- **Community:** Ask questions in GitHub Discussions

---

## Summary

**v2.0 achieves massive consolidation:**
- ✅ **68% tool reduction** (56 tools → 18 tools)
- ✅ **93% token savings** for container tools (~48k → ~3.4k chars)
- ✅ **Permission separation:** `query_*` (read) vs `manage_*` (write)
- ✅ **Consistent patterns:** `operation` + `containerType`/`entityType`
- ✅ **Future-proof:** Easy to add operations without new tools
- ✅ **Workflow optimization tools preserved:** `get_next_task` and `get_blocked_tasks` remain unchanged

**Migration is straightforward:**
1. Replace old tool names with consolidated tools
2. Add `operation` parameter
3. Add `containerType` or `entityType` parameter
4. Update any renamed parameters
5. Test thoroughly

**Breaking changes:**
- 40+ tools removed (no backward compatibility)
- Immediate migration required
- Database unchanged (safe rollback)

**Resources:**
- Complete examples above for every tool category
- Comprehensive troubleshooting guide
- Full operation reference tables
- Links to detailed tool documentation

**Migration time estimate:** 1-4 hours depending on codebase size and complexity.

---

**Last Updated:** 2025-10-19
**Version:** 2.0.0
**Status:** Production Ready
