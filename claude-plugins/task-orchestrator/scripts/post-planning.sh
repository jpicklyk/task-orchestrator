#!/usr/bin/env bash
# PostToolUse hook for ExitPlanMode: Creates MCP containers from approved plan.

cat <<'EOF'
{"hookSpecificOutput":{"hookEventName":"PostToolUse","additionalContext":"Plan approved. Materialize the plan into MCP Task Orchestrator containers:\n\n1. READ plan.md and check for an existing MCP Container UUID line.\n\n2. NEW PLAN (no UUID): Create containers efficiently:\n   a. Create the feature/project via manage_container(operation='create') with templateIds from the confirmed templates. Include summary from plan.\n   b. Create each task via manage_container(operation='create', containerType='task') with featureId, priority, complexity, and templateIds. Pass summary and description from the plan.\n   c. For any plan sections beyond what templates provide, add them as additional sections via manage_sections(operation='add') or bulkCreate on the appropriate container. Templates are the floor; extra content from the plan becomes additional sections.\n   d. Set up dependencies via manage_dependency(operation='create') matching the dependency notes in the plan.\n   e. Write all UUIDs back into plan.md so it reflects the full container hierarchy.\n\n3. REVISION (UUID exists): Query the existing container, compare with plan changes, update via manage_container(operation='update'). Check if tasks need adding, updating, or re-prioritizing.\n\n4. VERIFY dependencies: Call get_blocked_tasks(featureId='<uuid>') to confirm the dependency graph is correct. Report the work ordering to the user.\n\n5. Token efficiency tips: Use templateIds parameter during create (not separate apply_template calls). Use manage_sections(operation='bulkCreate') if adding multiple custom sections. Use manage_container(operation='bulkUpdate') for batch property changes.\n\nThe plan.md with UUIDs becomes the human-readable view of the MCP container hierarchy."}}
EOF
