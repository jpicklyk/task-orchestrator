#!/usr/bin/env bash
# PreToolUse hook for EnterPlanMode: Guides structured planning with tiered depth and template discovery.

cat <<'EOF'
{"hookSpecificOutput":{"hookEventName":"PreToolUse","additionalContext":"Planning mode activated. Follow this workflow:\n\n1. ASK PLANNING DEPTH: Use AskUserQuestion to ask how detailed this plan should be:\n   - Quick — Feature + tasks with titles and priorities. No templates. Good for small changes and straightforward work.\n   - Standard (Recommended) — Feature + tasks with documentation templates. Covers requirements, technical approach, and testing. Good for most features.\n   - Detailed — Full engineering plan with architecture, design decisions, and implementation specifications. Use for complex, multi-phase, or high-risk work.\n\n2. SIZE the work: Project + Features + Tasks (large multi-feature efforts), Feature + Tasks (focused scope, most common), or Standalone Tasks (small items).\n\n3. DISCOVER templates (skip for Quick): Call query_templates for both FEATURE and TASK types. For Standard, recommend: Requirements Specification, Task Implementation, Technical Approach, Test Plan. For Detailed, also include: Feature Plan, Codebase Exploration, Design Decision, Implementation Specification. Mark recommendations with '(Recommended)' in AskUserQuestion.\n\n4. ASK template selection (skip for Quick): Present discovered templates via AskUserQuestion with multiSelect:true. Let user add or remove from suggestions.\n\n5. WRITE the plan. Plan content varies by depth:\n   - Quick: A task breakdown table with title, priority, and one-line description per task. This IS the plan.\n   - Standard: Feature-level requirements/context sections (from templates), plus a task breakdown table (title, priority, one-line scope per task). Enough for the user to approve the work breakdown.\n   - Detailed: Full feature plan using template sections (problem statement, architecture, implementation phases, design decisions, risks, verification). Do NOT list tasks separately — the Implementation Phases section defines the work breakdown. Each phase becomes a task after approval.\n   Templates are the floor, not the ceiling — add content beyond what templates provide.\n\n6. REVISION CHECK: If plan.md already contains an MCP Feature UUID line (<!-- MCP Feature: ... -->), this is a revision. Skip depth/template discovery and focus on what changed.\n\nplan.md is the design document. MCP containers are created only after the user approves. Do not write task UUIDs or detailed task specifications into plan.md — MCP is the task tracker."}}
EOF
